<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missoula Scanner - Gamified</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        body {
            background: #190250;
            text-align: center;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
            overflow: hidden;
        }

        /* XP BAR */
        .xp-bar-container {
            width: 80%;
            background: rgba(255, 255, 255, 0.2);
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto;
        }

        .xp-bar {
            height: 100%;
            width: 0%;
            background: #FFD700;
            transition: width 0.5s ease-in-out;
        }

        /* BADGE UNLOCK POPUP */
        .badge-popup {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 255, 0, 0.9);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            color: white;
            display: none;
            z-index: 10;
            transition: top 0.5s ease-in-out;
        }

        /* LEADERBOARD */
        .leaderboard {
            margin-top: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-align: left;
            display: inline-block;
            width: 80%;
        }

        /* Daily Challenge */
        .challenge-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            width: 80%;
            text-align: center;
            font-weight: bold;
        }

        /* Badges */
        .badge {
            display: inline-block;
            background: rgba(255, 215, 0, 0.3);
            padding: 8px 15px;
            border-radius: 10px;
            margin: 5px;
        }
    </style>
</head>
<body>

    <h2>🏆 Scanner Gamification System</h2>

    <!-- XP BAR -->
    <p>XP Progress</p>
    <div class="xp-bar-container">
        <div class="xp-bar" id="xpBar"></div>
    </div>

    <!-- BADGE POPUP -->
    <div class="badge-popup" id="badgePopup">🏅 New Badge Earned!</div>

    <!-- DAILY CHALLENGE -->
    <div class="challenge-box">
        <p>🔥 Today's Challenge:</p>
        <p id="dailyChallenge">Loading...</p>
        <button onclick="completeChallenge()">✅ Complete</button>
    </div>

    <!-- LEADERBOARD -->
    <div class="leaderboard">
        <h3>🔥 Today's Top Listeners</h3>
        <ol id="leaderboardList">
            <li>🔹 User1 - 3 hrs</li>
            <li>🔹 User2 - 2.5 hrs</li>
            <li>🔹 User3 - 2 hrs</li>
        </ol>
    </div>

    <!-- BADGE GALLERY -->
    <h3>🏅 Earned Badges</h3>
    <div id="badgeGallery"></div>

    <script>
        let xp = localStorage.getItem("xp") ? parseInt(localStorage.getItem("xp")) : 0;
        let earnedBadges = localStorage.getItem("badges") ? JSON.parse(localStorage.getItem("badges")) : [];
        let dailyChallenge = localStorage.getItem("dailyChallenge") || null;
        let lastChallengeDate = localStorage.getItem("challengeDate") || null;

        // Function to add XP
        function addXP(amount) {
            xp += amount;
            localStorage.setItem("xp", xp);
            document.getElementById("xpBar").style.width = (xp % 100) + "%";
        }

        // Function to unlock a badge
        function unlockBadge(badgeName) {
            if (!earnedBadges.includes(badgeName)) {
                earnedBadges.push(badgeName);
                localStorage.setItem("badges", JSON.stringify(earnedBadges));

                let badgePopup = document.getElementById("badgePopup");
                badgePopup.innerHTML = badgeName + " Unlocked!";
                badgePopup.style.display = "block";
                badgePopup.style.top = "20px";

                setTimeout(() => {
                    badgePopup.style.top = "-100px";
                }, 3000);

                // Add badge to gallery
                let badgeGallery = document.getElementById("badgeGallery");
                let newBadge = document.createElement("span");
                newBadge.className = "badge";
                newBadge.innerText = badgeName;
                badgeGallery.appendChild(newBadge);
            }
        }

        // Function to handle daily challenges
        function setDailyChallenge() {
            const challenges = [
                { task: "Listen for 30 minutes", reward: 50 },
                { task: "Tune in to a major incident", reward: 100 },
                { task: "Listen for 3 days straight", reward: 150 }
            ];

            let today = new Date().toISOString().split("T")[0];

            if (!dailyChallenge || lastChallengeDate !== today) {
                let newChallenge = challenges[Math.floor(Math.random() * challenges.length)];
                localStorage.setItem("dailyChallenge", JSON.stringify(newChallenge));
                localStorage.setItem("challengeDate", today);
                dailyChallenge = newChallenge;
            }

            document.getElementById("dailyChallenge").innerText = dailyChallenge.task;
        }

        function completeChallenge() {
            let challenge = JSON.parse(localStorage.getItem("dailyChallenge"));
            addXP(challenge.reward);
            unlockBadge("🔥 Daily Winner");
            alert("Challenge Completed! You earned " + challenge.reward + " XP!");
        }

        // Load stored badges
        earnedBadges.forEach(badge => unlockBadge(badge));

        // Set daily challenge
        setDailyChallenge();

        // Simulate XP being earned every 5 seconds
        setInterval(() => addXP(10), 5000);
    </script>

</body>
</html>
